---
toc: true
title:  "BigDecimal íƒ€ì…ì˜ ì†Œìˆ˜ì  ê³„ì‚°ì— ì¡°ì‹¬í•˜ì"
last_modified_at:   2025-01-17
categories : Project
excerpt: "ì •í™•í•¨ì˜ ê¸°ì¤€ì„ ì„¤ì •í•˜ì"
image: ""
sitemap :
  changefreq : weekly
  priority : 1.0
use_math: true
published: true
---

Java, Kotlinì„ ì‚¬ìš©í•œë‹¤ë©´ `BigDecimal` íƒ€ì…ì„ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤. ì´ëŠ” ìì„¸í•œ ê°’ ê³„ì‚°ì´ í•„ìš”í•  ë•Œ ìœ ìš©í•˜ê²Œ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤.<br>
BigDecimalì´ ê°–ëŠ” í•„ë“œì—ëŠ” `intVal`, `intCompact`, `precision`, `scale`ì´ ìˆë‹¤.<br>
- intVal(BigInteger) : ê°’ ì €ì¥ (Long.MAX_VALUE ë³´ë‹¤ í´ ë•Œë§Œ ì €ì¥, ê·¸ë ‡ì§€ ì•Šìœ¼ë©´ null)
- intCompact(Long) : ê°’ ì €ì¥
- precision(Int) : ì´ ìë¦¿ìˆ˜
- scale : ì†Œìˆ˜ì  ì´í•˜ ìë¦¿ìˆ˜

ì˜ˆë¥¼ ë“¤ë©´, 0.15ëŠ” intVal = null, intCompact = 15, precision = 3, scale = 2ê°€ ëœë‹¤.<br>

Long íƒ€ì…ì„ ë„˜ì§€ ì•ŠëŠ” ì†Œìˆ˜ë§Œ ë‹¤ë£° ì˜ˆì •ì´ë¯€ë¡œ intVal, intCompactëŠ” ê·¸ëƒ¥ **ê°’ì„ ì €ì¥í•˜ëŠ” ê³³**ì´ë¼ê³  ìƒê°í•˜ê³ ,<br>
ì†Œìˆ˜ë‹ˆê¹Œ **scale**ì— ì§‘ì¤‘í•´ë³´ì. BigDecimal íƒ€ì…ì˜ ê°’ë¼ë¦¬ ì—°ì‚°ì„ í•´ë³¼ ê²ƒì´ë‹¤.<br>

BigDecimalì€ ì—°ì‚°ì„ í†µí•´ ìƒˆë¡œìš´ BigDecimalë¡œ í‘œí˜„ì´ ë  ë•Œ ê°€ì¥ ì •í™•í•œ ê°’ì´ ë‚˜ì˜¤ê²Œë” ì²˜ë¦¬í•œë‹¤.<br>
ì •í™•í•œ ê°’ì´ ë‚˜ì˜¨ë‹¤ëŠ” ê±´ scaleì´ ì‘ì•„ì§€ì§€ ì•ŠìŒì„ ì˜ë¯¸í•œë‹¤.<br>

### ë§ì…ˆ, ëº„ì…ˆ
ë§ì…ˆ, ëº„ì…ˆì—ì„œ scaleì´ ì–´ë–»ê²Œ ë³€í• ê¹Œ?<br>
scale ê°’ì´ 2ê°œ í”¼ì—°ì‚°ìê°€ ê°€ì§„ ê°€ì¥ í° scale ê°’ìœ¼ë¡œ ìœ ì§€ë  ê²ƒì´ë‹¤.<br>
ë§ì…ˆì„ ì˜ˆë¥¼ ë“¤ë©´ ì•„ë˜ì™€ ê°™ë‹¤. (ëº„ì…ˆë„ ê°™ë‹¤)<br>
```kotlin
0.1 // scale = 1
0.15 // scale = 2
0.1 + 0.15 = 0.25 // scale = 2
```

### ê³±ì…ˆ
ê³±ì…ˆì˜ ê²°ê³¼ë¥¼ ì •í™•í•˜ê²Œ í‘œí˜„í•˜ë ¤ë©´ scaleì´ í”¼ì—°ì‚°ìì˜ scaleì— ë¹„ë¡€í•  ê°€ëŠ¥ì„±ì´ ë†’ë‹¤.<br>
ìµœëŒ€ ë‘ í”¼ì—°ì‚°ìì˜ scale ê³±ì´ ë  ê²ƒì´ë‹¤.<br>
```kotlin
0.1 // scale = 1
0.15 // scale = 2
0.1 * 0.15 = 0.225 // scale = 3
```

### ë‚˜ëˆ—ì…ˆ
ë‚˜ëˆ—ì…ˆì˜ ê²°ê³¼ëŠ” ë¬´í•œ ì†Œìˆ˜ê°€ ë°œìƒí•  ìˆ˜ ìˆë‹¤. ê·¸ë˜ì„œ ì •í™•í•œ ê°’ì„ í‘œí˜„í•˜ëŠ”ê²Œ ë¶ˆê°€ëŠ¥í•  ìˆ˜ ìˆë‹¤.<br>
ê·¸ë˜ì„œ `BigDecimal(1).divide(BigDecimal(3))`ì„ ì‹¤í–‰í•˜ë©´ `ArithmeticException`ë¥¼ ë˜ì§„ë‹¤.<br>
```
java.lang.ArithmeticException: Non-terminating decimal expansion; no exact representable decimal result.
	at java.base/java.math.BigDecimal.divide(BigDecimal.java:1780)
```

ê·¸ë˜ì„œ divide(BigDecimal)ë¥¼ í˜¸ì¶œí•˜ëŠ” ê²½ìš° ë‚˜ëˆ„ì–´ ë–¨ì–´ì§€ëŠ” ê²½ìš°ì—ë§Œ ì‚¬ìš©í•´ì•¼ í•œë‹¤.<br>
ë°˜ë“œì‹œ ê°’ì„ ë‚´ë³´ë‚´ì•¼ í•œë‹¤ë©´ scaleê³¼ RoundingModeë¥¼ ì¸ìë¡œ ë„£ì–´ ê²°ê³¼ë¥¼ ì–»ì„ ìˆ˜ ìˆë‹¤.<br>
```kotlin
BigDecimal(1).divide(BigDecimal(3), 1, RoundingMode.DOWN) // 0.333... -> 0.3
```
- RoundingModeëŠ” ì˜¬ë¦¼, ë‚´ë¦¼, ë°˜ì˜¬ë¦¼ ë“±ì„ ì§€ì›í•˜ëŠ” enum íƒ€ì…ì´ë‹¤.

ì°¸ê³ ë¡œ Kotlinì—ì„œëŠ” `BigDecimal(1) / BigDecimal(3)`ë¥¼ ì‹¤í–‰í•˜ë©´ BigDecimal.ktì— êµ¬í˜„ëœ operator funì„ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤.
```kotlin
@kotlin.internal.InlineOnly
public inline operator fun BigDecimal.div(other: BigDecimal): BigDecimal = this.divide(other, RoundingMode.HALF_EVEN)
```
- ê²°ê³¼ê°’ì˜ scaleì€ **BigDecimalì˜ scaleì„ ë”°ë¼ê°„ë‹¤.**
  - BigDecimal(1) / ... ë¥¼ í•˜ë©´ BigDecimal(1)ì˜ scaleì€ 1ì´ë¯€ë¡œ ìµœì¢… scaleë„ 1ì´ ëœë‹¤.

## âš ï¸
### ê°’ 0.1
ì—¬ê¸°ê¹Œì§€ ì½ì—ˆë‹¤ë©´ BigDecimalì€ ì–´ë–»ê²Œ ê³„ì‚°í•˜ëŠ”ì§€ ê°ì„ ì¡ì•˜ì„ ê²ƒì´ë‹¤.<br>
ê·¸ëŸ¬ë©´ ì•„ë˜ ì§ˆë¬¸ì— ë‹µì„ í•´ë³´ì.<br>

BigDecimal(0.1)ì˜ scaleì€ ëª‡ì¼ê¹Œ?

ì‹¤í–‰í•´ë³´ë©´..
```kotlin
val num = BigDecimal(0.1)
println(num.scale()) // 55
```
- ì‹¬ì§€ì–´ëŠ” numì„ ì¶œë ¥í•˜ë©´ `0.1000000000000000055511151231257827021181583404541015625`ì´ ë‚˜ì˜¨ë‹¤.

ì´ìœ ëŠ” BigDecimal ìƒì„±ìì— ìˆëŠ” [ëª…ì„¸](https://github.com/openjdk-mirror/jdk7u-jdk/blob/master/src/share/classes/java/math/BigDecimal.java#L772)ì— ìì„¸íˆ ì¨ìˆë‹¤.<br>
ìš”ì•½í•˜ë©´ `0.1`ì€ Double íƒ€ì…ìœ¼ë¡œ ì •í™•íˆ í‘œí˜„í•  ìˆ˜ ì—†ì–´ì„œ ê·¸ë ‡ë‹¤. ë¶€ë™ì†Œìˆ˜ì  ë°©ì‹ìœ¼ë¡œëŠ” `0.1`ì„ ì •í™•íˆ í‘œí˜„í•  ìˆ˜ ì—†ë‹¤.<br>
ë‹¤ì‹œ ë§í•˜ë©´, 2ì§„ìˆ˜ë¡œ í‘œí˜„ë  ìˆ˜ ì—†ë‹¤.<br>

ê·¸ë˜ì„œ 0.1ì„ BigDecimalì— ë‹´ê³ ì‹¶ë‹¤ë©´ ì¸ìì— doubleì´ ì•„ë‹Œ **String**ì„ ë„£ëŠ”ê±¸ ê¶Œì¥í•œë‹¤.
```kotlin
val num = BigDecimal("0.1")
println(num) // 0.1
println(num.scale()) // 1
```
- ì°¸ê³ ë¡œ 2ì§„ìˆ˜ë¡œ í‘œí˜„ ê°€ëŠ¥í•œ 0.5ëŠ” BigDecimal(0.5)ë¥¼ ì¶œë ¥í•´ë„ 0.5ê°€ ë‚˜ì˜¨ë‹¤.

### (Kotlin í¸) ìƒì„±ì
ë‹¤ì‹œ 0.1 ì´ë¼ëŠ” ê°’ì„ ê°€ì§€ê³  ì´ˆê¸°í™”í•´ë³´ì.
ì•„ê¹Œ BigDecimal(0.1)ì€ `0.1000000000000000055511151231257827021181583404541015625`ì´ ë‚˜ì˜¨ë‹¤ê³  í–ˆë‹¤.

ê·¼ë° Kotlinì—ëŠ” Doubleì„ BigDecimalë¡œ ë§Œë“œëŠ” ë°©ë²•ì´ í•˜ë‚˜ ë” ìˆë‹¤. Double.`toBigDecimal()`ì„ ì‚¬ìš©í•˜ë©´ ëœë‹¤.
```kotlin
val num = (0.1).toBigDecimal()
println(num) // 0.1
println(num.scale()) // 1
```
- BigDecimals.kt ì—ì„œ ì§€ì›í•˜ëŠ” í™•ì¥í•¨ìˆ˜ë¡œ, `BigDecimal(this.toString())`ë¥¼ ë°˜í™˜í•œë‹¤.
- ê·¸ë˜ì„œ ìœ„ì—ì„œ ì‚´í´ë³¸ `BigDecimal(String)`ê³¼ ê°™ë‹¤.

0.1 ê°™ì´ Doubleìœ¼ë¡œ ì •í™•íˆ í‘œí˜„ë˜ì§€ ì•ŠëŠ” ê°’ì„ ì²˜ë¦¬í•˜ë ¤ë©´ `toBigDecimal()`ì„ ì‚¬ìš©í•˜ë©´ ëœë‹¤ëŠ” êµí›ˆì„ ì–»ì—ˆë‹¤.<br>
ê·¸ëŸ¬ë©´ ì•ìœ¼ë¡œ `toBigDecimal()`ë§Œ ì‚¬ìš©í•˜ë©´ ë ê¹Œ?<br>

ì•„ë˜ ê²°ê³¼ëŠ” ì–´ë–»ê²Œ ë‚˜ì˜¬ê¹Œ?
```kotlin
val num1 = (0.1).toBigDecimal()
val num2 = (3).toBigDecimal()
println(num1 / num2) // ğŸ¤”
```

ì •ë‹µì€.. **0.0**ì´ ë‚˜ì˜¨ë‹¤.<br>

ì´ìœ ëŠ” BigDecimal.div() ê²°ê³¼ì˜ scaleì€ **BigDecimalì˜ scaleì„ ë”°ë¼ê°€ê¸° ë•Œë¬¸ì´ë‹¤.**<br>
ì¦‰, `num1`ì˜ scaleì€ **1**ì´ë¯€ë¡œ `num1 / num2`ì˜ scale ì—­ì‹œ **1**ì´ ëœë‹¤.<br>
ê·¸ë˜ì„œ `0.03333`ì´ `0.0`ìœ¼ë¡œ í‘œí˜„ëœ ê²ƒì´ë‹¤.<br>

ë­”ê°€ ì •í™•í•œ ê°’ì„ ì«’ìœ¼ë ¤ê³  ë…¸ë ¥í–ˆëŠ”ë° ê²°ê³¼ê°€ ì •í™•í•˜ì§€ ì•Šë‹¤. `toBigDecimal()`ê°€ ë§ŒëŠ¥ì€ ì•„ë‹Œ ê²ƒ ê°™ë‹¤.<br>
ì¼ì • scale ê¹Œì§€ í˜€ìš©í•˜ëŠ” ë²”ìœ„ì—ì„œ ê·¼ì‚¬ì¹˜ë¥¼ ì–»ê³ ì‹¶ë‹¤ë©´, 2ê°€ì§€ ë°©ë²•ì´ ìˆë‹¤.<br>

1. `toBigDecimal()`ì„ ì‚¬ìš©í•˜ì§€ ë§ê³ , BigDecimal()ì„ ì‚¬ìš©í•˜ê¸°

`setScale(scale, roundingMode)` í•¨ìˆ˜ë¥¼ ì‚¬ìš©í•˜ë©´ ë‚´ê°€ ì›í•˜ëŠ” ë²”ìœ„ì—ì„œ ê°’ì„ ì–»ì„ ìˆ˜ ìˆë‹¤.
```kotlin
val num1 = BigDecimal(0.1)
val num2 = BigDecimal(3)
println(num1 / num2) // 0.0333333333333333351837050410419275673727194468180338542
println((num1 / num2).setScale(5, RoundingMode.CEILING)) // 0.03334
println((num1 / num2).setScale(5)) // java.lang.ArithmeticException: Rounding necessary
```
- 0.1 / 3 = 0.0333... ì´ë¯€ë¡œ ë‚˜ëˆ„ì–´ ë–¨ì–´ì§€ì§€ ì•Šì•„ ArithmeticExceptionë¥¼ ë˜ì§„ë‹¤. ì£¼ì˜í•˜ì.

2. BigDecimal#`divide()` ì‚¬ìš©í•˜ê¸°

divide(bigDecimal, scale, roundingMode)ë¥¼ ì‚¬ìš©í•˜ë©´ ë‚˜ëˆ„ëŠ” ê³¼ì •ì—ì„œ scale, roundingModeë¥¼ ì ìš©í•  ìˆ˜ ìˆë‹¤.
```kotlin
val num1 = BigDecimal(0.1)
val num2 = BigDecimal(3)
println(num1.divide(num2, 5, RoundingMode.CEILING)) // 0.03334

val num1 = (0.1).toBigDecimal()
val num2 = (3).toBigDecimal()
println(num1.divide(num2, 5, RoundingMode.CEILING)) // 0.03334
```
- ì—¬ê¸°ëŠ” `toBigDecimal()`ë„ ê°€ëŠ¥í•˜ë‹¤.

<br>
ëŒ€ì‹  ì´ëŸ°ê±´ ì•ˆëœë‹¤.
```kotlin
val num1 = (0.1).toBigDecimal()
val num2 = (3).toBigDecimal()
println((num1 / num2).setScale(5, RoundingMode.CEILING)) // 0.00000
```
- num1 / num2 ì—ì„œ ì´ë¯¸ ê²°ê³¼ê°€ `0.0`ì´ë‹¤. `0.0`ì„ scale = 5ë¡œ ë§ì¶°ë´¤ì `0.00000`ì¼ ë¿ì´ë‹¤.


## References
- [github/openjdk-mirror: BigDecimal.java](https://github.com/openjdk-mirror/jdk7u-jdk/blob/master/src/share/classes/java/math/BigDecimal.java#L772)
- [kingjakeu: BigDecimal ê¸°ë³¸ ì •ë¦¬, BigDecimal í™œìš© in Java](https://kingjakeu.github.io/java/2020/12/23/bigdecimal/)
- [ë°”ì½”94: ì†Œìˆ˜ì ì„ í‘œí˜„í•˜ëŠ” ë°©ë²•](https://bako94.tistory.com/328)