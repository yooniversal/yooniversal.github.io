---
toc: true
title:  "[Python] Google Drive íŒŒì¼ ì—…ë¡œë“œë¶€í„° ì´ë¯¸ì§€ ë§í¬ ìƒì„±ê¹Œì§€ í•´ë³´ê¸°"
last_modified_at:   2024-03-30
categories : Study
excerpt: ""
image: ""
sitemap :
  changefreq : weekly
  priority : 1.0
use_math: true
published: true
---

[Git repo ë§í¬](https://github.com/yooniversal/google-drive-img-src-generator)ì— ìˆëŠ” ë‚´ìš©ê³¼ ê°™ìœ¼ë‹ˆ ë°”ë¡œ í™•ì¸í•˜ì…”ë„ ì¢‹ìŠµë‹ˆë‹¤.<br>

## ë™ê¸°
Github ë¸”ë¡œê·¸ë¥¼ ìš´ì˜í•˜ë©´ì„œ ì´ë¯¸ì§€ ì—…ë¡œë“œ í•˜ëŠ” ê³¼ì •ì´ ìƒë‹¹íˆ ê·€ì°®ì„ ë•Œê°€ ë§ì•˜ë‹¤ğŸ˜¤<br>
êµ³ì´ Google Driveê¹Œì§€ ë“¤ì–´ê°€ì„œ `íŒŒì¼ ì—…ë¡œë“œ -> ê³µìœ  ì„¤ì • -> ë§í¬ ë³µì‚¬ -> img srcë¡œ ì“°ë„ë¡ ì ì ˆíˆ ìˆ˜ì •`í•˜ëŠ” ê³¼ì •ì„<br>
ê±°ì¹˜ì§€ ë§ê³ , **ì‹¤í–‰ -> img srcë¡œ ì“¸ ìˆ˜ ìˆëŠ” ë§í¬ ì–»ê¸°**ë¥¼ ë°”ë¡œ í•´ì£¼ëŠ” ë¡œì§ì„ ë§Œë“¤ì–´ë³´ê³  ì‹¶ì—ˆë‹¤!<br>

ë‚˜ê°™ì€ ê²½ìš° img srcì— ë„£ëŠ” ì´ë¯¸ì§€ ë§í¬ í˜•íƒœëŠ” ì•„ë˜ì™€ ê°™ì€ë°,<br>
```
https://lh3.google.com/u/0/d/{file-id}
```

ìµœì¢…ì ìœ¼ë¡œ ì´ë ‡ê²Œ ì ìš©í•  ìˆ˜ ìˆë‹¤..!<br>
```html
<img src="https://lh3.google.com/u/0/d/{file-id}" title="test-img.png" alt="test-img.png"/>
```

## Prerequisites
- Python
  + google-api-python-client íŒ¨í‚¤ì§€ (googleapiclient.discovery)
  + oauth2client íŒ¨í‚¤ì§€
- Google Cloud Platform
  + í”„ë¡œì íŠ¸ ìƒì„±
  + ì‚¬ìš©ì ì¸ì¦ ì •ë³´ ìƒì„±
  + í…ŒìŠ¤íŠ¸ ì‚¬ìš©ì ë“±ë¡
  + OAuth í´ë¼ì´ì–¸íŠ¸ ID ë§Œë“¤ê¸°
  + `folder_id` ë³µì‚¬

<br>

### 0. Python

Python ì„¤ì¹˜ ë° ì½”ë“œ í¸ì§‘ ê°€ëŠ¥í•œ í™˜ê²½(Visual Studio Code, PyCharm ë“±) ì„¸íŒ…ì€ ìƒëµí•œë‹¤.<br>
Python ì„¤ì¹˜ê°™ì€ ê²½ìš° [wikidocs](https://wikidocs.net/8)ì—ë„ ì˜ ë‚˜ì™€ìˆìœ¼ë‹ˆ ì°¸ê³ í•˜ë©´ ì¢‹ì„ ê²ƒ ê°™ë‹¤.<br>

Google Driveì— íŒŒì¼ ì—…ë¡œë“œë¥¼ í•˜ë ¤ë©´ ì œê³µí•˜ëŠ” APIë¥¼ ì‚¬ìš©í•´ì•¼ í•˜ê¸° ë•Œë¬¸ì—, ì•„ë˜ 2ê°€ì§€ë¥¼ importí•  ìˆ˜ ìˆì–´ì•¼ í•œë‹¤.<br>
- googleapiclient.discovery
- oauth2client

ë§Œì•½ ì‹¤í–‰í–ˆëŠ”ë° **ModuleNotFoundError**ê°€ ë°œìƒí•œë‹¤ë©´ terminalì—ì„œ ì•„ë˜ ëª…ë ¹ì–´ë¥¼ ì…ë ¥í•´ì¤˜ì•¼ í•œë‹¤.<br>
```s
# googleapiclient.discovery
pip3 install google-api-python-client

# oauth2client
pip3 install --upgrade oauth2client
```
<br>

### 1. Google Cloud Platform í”„ë¡œì íŠ¸ ìƒì„±ì„ í•˜ì§€ ì•Šì•˜ë‹¤ë©´ [ì—¬ê¸°](https://console.cloud.google.com/)ë¥¼ í´ë¦­í•´ì£¼ì„¸ìš”.

Google Drive APIë¥¼ í™œìš©í•˜ë ¤ë©´ `í”„ë¡œì íŠ¸ ë“±ë¡`ë¶€í„° `OAuth í´ë¼ì´ì–¸íŠ¸ ID ë§Œë“¤ê¸°`ê¹Œì§€ ë°˜ë“œì‹œ í•´ì¤˜ì•¼í•˜ëŠ” ì‘ì—…ì´ ìˆë‹¤!<br>
ì²œì²œíˆ ë”°ë¼ê°€ë³´ì.<br>

<img width="1066" alt="make-project-google-cloud-platform" src="https://github.com/yooniversal/google-drive-img-src-generator/assets/61930524/51e71a0b-ca7d-472b-ba5e-745c627f99cd"><br>

### 2. ì‚¬ìš©ì ì¸ì¦ ì •ë³´ ìƒì„±
   
<br>
<img width="1449" alt="make-user-information-for-auth" src="https://github.com/yooniversal/google-drive-img-src-generator/assets/61930524/38da813b-7c36-431e-bf0e-f0d1741fe616"><br>

UserType `ì™¸ë¶€(external)` ì„¤ì • â†’ ë§Œë“¤ê¸° í´ë¦­ í›„, `í…ŒìŠ¤íŠ¸ ì‚¬ìš©ì` ë‹¨ê³„ê°€ ë‚˜ì˜¬ ë•Œê¹Œì§€ **ì €ì¥ í›„ ê³„ì†** ë²„íŠ¼ í´ë¦­

<img width="450" alt="select-UserType" src="https://github.com/yooniversal/google-drive-img-src-generator/assets/61930524/69c6a6ac-2224-4824-bce1-0fd7875ba43c"><br>

### 3. í…ŒìŠ¤íŠ¸ ì‚¬ìš©ì ë“±ë¡

Google Drive APIë¥¼ ì‚¬ìš©í•´ ì—…ë¡œë“œí•˜ê¸° ë•Œë¬¸ì—, ì‚¬ìš©í•  í…ŒìŠ¤íŠ¸ ê³„ì •ì´ í•„ìš”í•˜ë‹¤. ì›í•˜ëŠ” ê³„ì •ì„ ë“±ë¡í•´ì£¼ì.<br>

<img width="1051" alt="create-test-user" src="https://github.com/yooniversal/google-drive-img-src-generator/assets/61930524/10ea1165-084e-4cd2-af3d-8f664036fdaa"><br>

### 4. OAuth í´ë¼ì´ì–¸íŠ¸ ID ë§Œë“¤ê¸°
- ì• í”Œë¦¬ì¼€ì´ì…˜ ìœ í˜• : **ë°ìŠ¤í¬í†± ì•±**
- ì´ë¦„ ì…ë ¥ í›„ `ë§Œë“¤ê¸°` ë²„íŠ¼ í´ë¦­

<img width="1113" alt="create-oauth-client-id" src="https://github.com/yooniversal/google-drive-img-src-generator/assets/61930524/57740578-10b1-4939-8e36-364afc9d751c"><br>

ìƒì„±í•œ **í´ë¼ì´ì–¸íŠ¸ ID/PW json íŒŒì¼**ì€ ë¡œì§ì—ì„œ ì‚¬ìš©í•˜ê¸° ë•Œë¬¸ì— ë°˜ë“œì‹œ í•„ìš”í•˜ë‹¤! ë‹¤ìš´ë¡œë“œ í•´ì£¼ì.<br>
API í˜¸ì¶œì— í•„ìš”í•œ OAuth2 í† í° ìƒì„± ì‹œ í•„ìš”í•œ íŒŒì¼ì´ë‹¤.<br>

<img width="510" alt="download-oauth-client-information-json" src="https://github.com/yooniversal/google-drive-img-src-generator/assets/61930524/aeceb951-0666-4e66-ba9a-b670b4a1b242">

### 5. `folder_id` ë³µì‚¬

Google Driveì—ì„œ íŒŒì¼ì„ ì—…ë¡œë“œí•  ìµœì¢… ê²½ë¡œ folderì˜ idê°€ í•„ìš”í•˜ë‹¤.<br>
ë³µì‚¬ í›„ í•˜ë‹¨ì˜ `ì½”ë“œ ìˆ˜ì •` ì°¸ì¡°í•´ `google-drive-img-src-generator.py` ì•ˆì— `folder_id`ì— ë¶™ì—¬ë„£ê¸° í•´ì£¼ì.<br>

<img width="800" alt="image" src="https://github.com/yooniversal/google-drive-img-src-generator/assets/61930524/026e4366-514a-430d-8297-13b59a4ec9a4"><br>

<br>

## ì½”ë“œ ìˆ˜ì •
git clone í›„ `google-drive-img-src-generator.py`ë¥¼ ì‹¤í–‰í•´ì£¼ì.<br>
```
git clone https://github.com/yooniversal/google-drive-img-src-generator.git
```
<br>

ì£¼ì„ í‘œì‹œí•œ ë¶€ë¶„ì„ í™•ì¸í•´ ë‹¤ìŒ ë‚´ìš©ì„ ì±„ìš´ ë’¤ runí•˜ë©´ ê²°ê³¼ë¥¼ ì–»ì„ ìˆ˜ ìˆë‹¤.<br>
(ì°¸ì¡°í•  íŒŒì¼ë“¤ì€ `google-drive-img-src-generator.py`ì™€ **ë°˜ë“œì‹œ ê°™ì€ ê²½ë¡œì— ìˆì–´ì•¼ í•œë‹¤.**)
- OAuth í´ë¼ì´ì–¸íŠ¸ json íŒŒì¼ëª…
- ì—…ë¡œë“œ í•  íŒŒì¼ëª… (ì—¬ëŸ¬ê°œ ê°€ëŠ¥)
- ì—…ë¡œë“œí•  Google Drive ìµœì¢… ê²½ë¡œ `folder-id`

```python
def main():
    # ìƒëµ

    if not creds or creds.invalid:
        oauth_client_json_file = '{json-file-name}' # OAuth í´ë¼ì´ì–¸íŠ¸ json íŒŒì¼ëª… ì…ë ¥
        flow = client.flow_from_clientsecrets(oauth_client_json_file, SCOPES)
        creds = tools.run_flow(flow, store, flags) if flags else tools.run(flow, store)

    DRIVE = build('drive', 'v3', http=creds.authorize(Http()))

    FILES = (
        # ì—…ë¡œë“œ í•  íŒŒì¼ëª… ì…ë ¥
        ('upload-file-1.png'),
        ('upload-file-2.png'),
    )

    folder_id = '{folder-id}' # ì—…ë¡œë“œí•  Google Drive ìµœì¢… ê²½ë¡œ folder-id ì…ë ¥

    for file_title in FILES:
        request_body = {'name': file_title, 'parents' : [folder_id], 'uploadType': 'multipart'}
        media = MediaFileUpload(file_title, mimetype=get_image_mimetype(file_title))

        res = DRIVE.files().create(body=request_body, media_body=media, fields='id,webViewLink').execute()
        if res:
            key = extract_key_from_uri(res.get('webViewLink'))
            print(f"[{file_title}] >> {get_upload_uri(key)}") # ìµœì¢… URI ì¶œë ¥
```
<br>

## ê²°ê³¼
```
[upload-file-1.png] >> https://lh3.google.com/u/0/d/{file-id}
[upload-file-2.png] >> https://lh3.google.com/u/0/d/{file-id2}
```
<br>

## ìˆ˜ì •(í™•ì¥) ê°€ëŠ¥ ë¶€ë¶„
ì´ë¯¸ì§€ íŒŒì¼ì„ ì—…ë¡œë“œí•˜ëŠ”ë° ì´ˆì ì„ ë§ì·„ë‹¤ë³´ë‹ˆ í™•ì¥ì ëª…ì„ ë½‘ì„ ë•Œ 4ê°€ì§€ë¡œ ì œí•œí–ˆë‹¤. (ê¸°ë³¸ê°’ `png`)<br>
ë‹¤ë¥¸ íƒ€ì…ì˜ íŒŒì¼ì„ ì²˜ë¦¬í•˜ëŠ”ê±°ë¼ë©´ í•„ìš”ì— ë”°ë¼ í™•ì¥í•  ìˆ˜ ìˆë‹¤.<br>
```python
def get_image_mimetype(file_title):
    if file_title.endswith('.jpeg') or file_title.endswith('.jpg'):
        return 'image/jpeg'
    if file_title.endswith('.png'):
        return 'image/png'
    if file_title.endswith('.gif'):
        return 'image/gif'
    return 'image/png'
```
<br>

`extract_key_from_uri()`ëŠ” Google Drive APIë¡œ ê°€ì ¸ì˜¨ ì—…ë¡œë“œí•œ íŒŒì¼ì˜ ê³µìœ  ë§í¬ì—ì„œ **file-id**ë§Œ ë¹¼ë‚´ëŠ” í•¨ìˆ˜ë‹¤.<br>
ê¸°ì¡´ ê³µìœ  ë§í¬ê°€ `https://drive.google.com/file/d/{fild-id}/view\?usp=drivesdk` í˜•íƒœì—¬ì„œ ì •ê·œ í‘œí˜„ì‹ì„<br>
í™œìš©í–ˆë‹¤. ì—¬ê¸°ì„œëŠ” ì´ `file-id`ë¥¼ ê°„ë‹¨íˆ ë¶€ë¥´ê¸° ìœ„í•´ **key**ë¼ê³  ëª…ëª…í–ˆë‹¤.<br>

`get_upload_uri()`ëŠ” ë‚´ê°€ í™œìš©í•˜ëŠ” img src í˜•íƒœê°€ `https://lh3.google.com/u/0/d/{file-id}`ê¸° ë•Œë¬¸ì—<br>
`extract_key_from_uri()`ë¡œ ì–»ì€ keyë¥¼ postfixë¡œ í™œìš©í•´ ì ì ˆí•œ í˜•íƒœì˜ ë§í¬ë¡œ ë°˜í™˜í•˜ëŠ” í•¨ìˆ˜ë‹¤.<br>
ì›í•˜ëŠ” í˜•íƒœì— ë§ê²Œ ìˆ˜ì •í•´ì¤˜ë„ ëœë‹¤.<br>
```python
def extract_key_from_uri(uri):
    pattern = r"https://drive.google.com/file/d/([^/]+)/view\?usp=drivesdk"
    match = re.match(pattern, uri)
    if match:
        return match.group(1)
    return None
    
def get_upload_uri(key):
    return 'https://lh3.google.com/u/0/d/' + key
```

## References
- [YSY: [Python] íŒŒì´ì¬ê³¼ êµ¬ê¸€ ë“œë¼ì´ë¸Œ ì—°ë™í•˜ê³  íŒŒì¼ ì—…ë¡œë“œ/ë‹¤ìš´ë¡œë“œ í•˜ê¸° (Google Drive)](https://ysyblog.tistory.com/296)
- [pbj0812: [PYTHON] pythonì„ ì‚¬ìš©í•œ Google Drive ì— íŒŒì¼ ì—…ë¡œë“œ](https://pbj0812.tistory.com/193)
- [JeeU147 : êµ¬ê¸€ ì¸ì¦(Google Auth) ìŠ¹ì¸ ì˜¤ë¥˜ 403 ì˜¤ë¥˜: access_denied](https://jeeu147.tistory.com/91)